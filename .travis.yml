language: c
compiler:
  - gcc
install:
  - sudo apt-get update -qq
  - sudo apt-get install -y gcc-mingw-w64
  - sudo apt-get install -y g++-mingw-w64
  - sudo apt-get install -y -qq cmake
script:
  - mkdir target
  - cd target
  - cmake .. -DCMAKE_TOOLCHAIN_FILE=../mingw-w64.cmake -DJANSSON_BUILD_DOCS=OFF -DJANSSON_WITHOUT_TESTS=ON -DJANSSON_BUILD_SHARED_LIBS=ON
  - make
  - make install
  - cd ..
before_deploy:
  - cd install
  - zip jansson.zip -r .
deploy:
  provider: releases
  api_key:
    secure: IwNh1YypYP41kGVajxWkN2SGJq1dyHL5TFAlSCOiJqAmIGAkJENarJppJKHnwni23f7rH2wOP1JX+mURMU/YjjD76Jssepp/tCx3anWtjKRbZL7b37DXPOPOJnYJsrUSta4i/FDZgwJgIAPvMvT1ohe5xsjS4g1k3wkcl0ZgcXM=
  file: jansson.zip
  on:
    tags: true
    repo: firepick-delta/jansson
    branch: mingw-w64
